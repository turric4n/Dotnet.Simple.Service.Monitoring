@page "/monitoring"
@using Microsoft.Extensions.Diagnostics.HealthChecks
@model Simple.Service.Monitoring.UI.Models.IndexModel
@{
    ViewData["Title"] = "Service Monitoring";
}

<h1>Service Monitoring Dashboard</h1>

<div class="row">
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header bg-@GetStatusColor(Model.OverallStatus)">
                <div class="d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">System Health</h4>
                    <span class="badge bg-@GetStatusColor(Model.OverallStatus) text-white">@Model.OverallStatus</span>
                </div>
                <small>Last Updated: @Model.LastUpdated</small>
                <div class="mt-2">
                    <span id="connection-status" class="text-secondary">Connecting...</span>
                    <button id="refresh-monitoring" class="btn btn-sm btn-outline-light ms-2">Refresh</button>
                </div>
            </div>
            <div class="card-body">
                <h5>Health Checks</h5>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Service</th>
                                <th>Status</th>
                                <th>Description</th>
                                <th>Duration</th>
                                <th>Last Updated</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var check in Model.HealthChecks)
                            {
                                    <tr class="@GetRowClass(check.Status)">
                                        <td><strong>@check.Name</strong></td>
                                        <td><span class="badge bg-@GetStatusColor(check.Status)">@check.Status</span></td>
                                        <td>@check.Description</td>
                                        <td>@check.Duration ms</td>
                                        <td>@check.LastUpdated.ToString("yyyy-MM-dd HH:mm:ss UTC")</td>
                                    </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    private string GetStatusColor(object statusObj)
    {
        var status = statusObj?.ToString();
        return status switch
        {
            "Healthy" => "success",
            "Degraded" => "warning",
            "Unhealthy" => "danger",
            _ => "secondary"
        };
    }

    private string GetRowClass(object statusObj)
    {
        var status = statusObj?.ToString();
        return status switch
        {
            "Healthy" => "table-success",
            "Degraded" => "table-warning",
            "Unhealthy" => "table-danger",
            _ => ""
        };
    }
}
